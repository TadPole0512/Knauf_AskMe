아래의 내용은 현재 운영 중인 웹 프로젝트에 추가할 내용인데 개발 단계별로 정리해서 알려줘.


[개발환경]
- 개발툴 : STS4.5
- 자바 : Zulu-8
- DB : mssql

[개발 내용]
- 엑셀 업로드를 통한 DB 테이블의 값을 업데이트


[엑셀 파일 내용]
- 추가 1. 엑셀 파일에 SalesDocument, Sales Document Item, Reason for rejection 컬럼, DS(Delivery status) 컬럼, OS(Overall status) 컬럼은 반드시 존재.
- 추가 2. 엑셀 파일에 컬럼은 추가 1.에서 얘기한 컬럼보다 많음.
- 추가 3. 엑셀 파일에 컬럼의 순서가 파일마다 다름.
- 추가 4. 엑셀 파일에 컬럼의 갯수가 파일마다 다름.
- 추가 5. 엑셀 파일의 경우 행이 13000개 이상일 경우가 있음.

[DB 작업]
엑셀 파일에서 얻은 오더번호로 DB 테이블 O_SALESORDER, QMS_SALESORDER에서 오더번호를 찾아 아래의 작업을 해야함.
    - 두 개 테이블(O_SALESORDER, QMS_SALESORDER)을 모두 동일하게 업데이트
SalesDocument, Sales Document Item*100를 AND조건으로 활용하여 ORDERNO, LINE_NO와 매칭
    - 엑셀 파일의 Sales Document Item 컬럼의 값이 DB 테이블의 LINE_NO의 1/100이므로 값을 비교할 때 Sales Document Item에 100을 곱해야 함.

1. Reason for rejection 컬럼의 값이 Null이 아닌 경우
    A. 해당 ORDER의 STATUS1 – 980, STATUS – 999, STATUS_DESC – 오더취소
2. DS 컬럼의 값이 C인 경우
    A. 해당 ORDER의 STATUS1 – 580, STATUS – 620, STATUS_DESC – 배송완료
3. DS 컬럼의 값이 Null 이고 OS 컬럼의 값이 C인 경우
    A. 해당 ORDER의 STATUS1 – 580, STATUS – 620, STATUS_DESC – 배송완료

위의 1,2,3 경우가 중복될 때는 1번이 최우선이며, 2번이 우선 적용하면 됨


[작업 개요]
1. 웹 페이지에서 엑셀 업로드 기능을 이용.
2. 사용자가 엑셀 파일을 업로드하는 즉시 작업 진행.
3. 엑셀 진행률에 대한 정보를 보여주는 것도 필요.
4. 작업이 마무리 되면 웹페이지(화면)에 실패한 건들의 키값과 실패이유에 대한 리포트 제공

[이슈]
1. 작업 속도
    - 임시 테이블을 먼저 만들어 엑셀 파일을 먼저 전체 다 임시 테이블에 저장하고 나서 DB작업은 임시 테이블에서 실행
        A. 작업은 DB에 임시테이블을 만들어서 엑셀 파일에 대한 모든 내용을 전부 업데이트
        B. 임시테이블에서 [DB 작업]의 작업들을 테이블 대 테이블을 비교하면서 진행
    - 엑셀 파일에 컬럼의 갯수가 다르고 몇 개로 구성되어 질 지 모르는 상황에서 임시 테이블 생성.
	- 엑셀 파일마다 컬럼의 순서가 다를 수 있어 임시테이블 생성 시 컬럼의 타입을 엑셀 파일 컬럼에 맞춰 생성
2. 진행률 표시
    - 작업 속도에 미치는 영향

3. 리포트 제공
    - 실패에 대한 정보를 저장하는 테이블 필요?


---------------------------------------------------------------------



아래는 \*\*웹 프로젝트에 "엑셀 업로드를 통한 DB 업데이트 기능"\*\*을 추가할 때의 **개발 단계별 상세 가이드**입니다. 각 단계는 현실적인 이슈와 요구사항을 모두 반영하여 작성했습니다.

---

## 1. 요구사항 분석 및 설계

### 1-1. 요구사항 파악

* **엑셀 업로드 → 임시테이블 저장 → 검증 및 조건에 맞는 DB 업데이트 → 결과 리포트 제공**
* 엑셀 파일 특성(컬럼, 행 수, 순서, 명칭 등) 정리
* DB 업데이트 조건(우선순위 로직) 정리

### 1-2. 시스템 설계

* **임시테이블 설계**

  * 동적 컬럼 매핑 지원 (컬럼명/타입을 엑셀 파일 기반으로 생성)
* **DB Update 로직 설계**

  * 우선순위 로직 명확화(1→2→3 순)
  * O\_SALESORDER, QMS\_SALESORDER 동시 업데이트
* **결과 리포트 설계**

  * 실패/예외 데이터 저장용 테이블 또는 임시 메모리 구조 설계
* **진행률 표시 설계**

  * 백엔드-프론트 간 진행률 통신(웹소켓, Ajax polling 등)

---

## 2. UI/UX 및 화면 개발

### 2-1. 엑셀 업로드 화면 구현

* 엑셀 파일 선택 및 업로드 버튼
* 업로드 후 작업 자동 시작

### 2-2. 진행률 표시

* Progress bar, % 숫자 등
* (Ajax, WebSocket 활용)

### 2-3. 결과 리포트 화면

* 실패건 테이블(오더번호, 실패 이유 등)
* 리포트 다운로드(엑셀/CSV)

---

## 3. 백엔드 개발(STS, Java, MyBatis 등)

### 3-1. 엑셀 파일 파싱

* **라이브러리 선택:** Apache POI, JExcel 등
* 파일 업로드 후 서버 임시경로에 저장 및 파싱
* **파싱 시 컬럼명/순서/수 자동 매핑**

### 3-2. 임시테이블 생성 및 데이터 적재

* **엑셀 구조에 맞춘 임시테이블(Temporary Table) 동적 생성**

  * 컬럼명/타입 자동 생성(SQL문 Build)
  * 대용량/병렬 처리 고려
* **데이터 Bulk Insert**로 임시테이블 저장

### 3-3. 검증 및 실제 DB 업데이트

* **업데이트 로직 (1→2→3 우선순위 적용)**

  * 임시테이블 → O\_SALESORDER, QMS\_SALESORDER 두 곳에 동시 적용
  * 엑셀의 Sales Document Item \* 100 = DB의 LINE\_NO
  * 조건 별로 STATUS 값 업데이트
* **실패/예외(매칭 불가 등) 기록**

  * 실패건/예외건은 별도 테이블 혹은 메모리 구조에 저장

### 3-4. 트랜잭션 관리/최적화

* 대량 데이터 처리시 배치로 처리 (JDBC Batch, MyBatis batch 등)
* 적절한 커밋/롤백 처리

### 3-5. 진행률 통신

* 작업 진행 상황을 클라이언트에 실시간 전송 (예: SSE, WebSocket, Ajax polling)

---

## 4. 리포트/결과 제공

### 4-1. 실패 데이터 조회/다운로드 기능

* 웹 화면에 표로 제공
* CSV/엑셀 다운로드 지원

### 4-2. 로그/에러 처리

* 에러/예외 발생 시 상세 사유 저장
* 관리자가 직접 원인 추적 가능하도록 로그 남김

---

## 5. 테스트 및 배포

### 5-1. 대용량 파일 테스트

* 13,000행 이상의 엑셀 파일로 성능/속도 테스트

### 5-2. 오류/예외 상황 테스트

* 컬럼명 오타/누락/순서 뒤바뀜
* 데이터 매칭 실패/오류 등

### 5-3. 배포 및 운영환경 적용

* 운영 DB 백업 필수
* 배포 후 모니터링 및 초기 피드백 반영

---

## 6. 기타 고려사항

* **임시테이블 자동 삭제(정기 batch 또는 스케줄러)**
* **DB Lock/Deadlock 예방** (대량 업데이트 시 Lock 경합 주의)
* **다국어/엑셀 파일 인코딩 지원**

---

# 단계별 주요 개발 포인트 요약

| 단계     | 주요 작업                            |
| ------ | -------------------------------- |
| 설계     | 요구사항, 임시테이블, Update 로직, 리포트 구조   |
| 프론트엔드  | 파일 업로드, 진행률, 결과 표시               |
| 백엔드    | 엑셀 파싱, 임시테이블 생성, DB Update, 예외처리 |
| 결과/리포트 | 실패/예외 관리, 다운로드, 로그 기록            |
| 테스트/배포 | 대용량/오류 테스트, 롤백, 배포, 모니터링         |

---

## (참고) 개발 단계별 구체 코드/구현 예시가 필요하면, 각 단계별로 샘플 코드나 설계안도 추가로 제공 가능합니다.

필요하신 세부 단계나 예시가 있으면 언제든 요청해 주세요!



