안녕하세요. 요청하신 Java(Spring) + Tomcat + MSSQL 환경의 작업 흐름 문서를 마크다운 형식으로 정리해 드립니다. 개발, QA, 운영 담당자 모두 쉽게 이해할 수 있도록 핵심 내용 위주로 구성했습니다.

# 엑셀 업로드 DB 업데이트 기능 개발 작업 흐름 문서

## 1. 요구사항 명세
    * 사용자는 웹페이지에서 엑셀 파일을 업로드해 DB 데이터를 일괄 업데이트할 수 있어야 합니다.
    * 업로드 즉시 백그라운드에서 작업이 시작되며, 사용자는 화면에서 진행률을 확인할 수 있어야 합니다.
    * 업데이트 대상 테이블은 O_SALESORDER와 QMS_SALESORDER이며, 두 테이블을 동일하게 업데이트해야 합니다.
    * 엑셀 파일은 SalesDocument, Sales Document Item, Reason for rejection, DS, OS 컬럼을 반드시 포함합니다.
    * 엑셀 파일마다 컬럼의 순서와 개수가 다를 수 있으므로 동적으로 처리해야 합니다.
    * Sales Document Item 컬럼 값에 100을 곱한 값이 DB의 LINE_NO와 일치하는 레코드를 찾아 업데이트를 수행합니다.
    * 업데이트 비즈니스 로직은 우선순위에 따라 순차적으로 적용됩니다.
        * 1순위: Reason for rejection 컬럼 값이 Null이 아닌 경우 (STATUS1: 980, STATUS: 999, STATUS_DESC: 오더취소)
        * 2순위: DS 컬럼 값이 'C'인 경우 (STATUS1: 580, STATUS: 620, STATUS_DESC: 배송완료)
        * 3순위: DS 컬럼 값이 Null이고 OS 컬럼 값이 'C'인 경우 (STATUS1: 580, STATUS: 620, STATUS_DESC: 배송완료)
    작업 완료 후, 실패한 건들의 키값과 실패 사유를 포함한 보고서가 화면에 표시되어야 합니다.

## 2. 영향도 분석
    모듈: 엑셀 파일을 파싱하고 DB에 대량으로 데이터를 삽입하는 새로운 서비스 모듈을 추가합니다. 기존 컨트롤러 및 데이터 처리 로직에 새로운 기능 호출 코드를 추가하게 됩니다.
    데이터베이스: 대량 데이터 처리를 위한 임시 테이블이 신규로 생성됩니다. 기존 O_SALESORDER, QMS_SALESORDER 테이블에 대한 대규모 업데이트 쿼리가 발생하므로, 작업 중 테이블 락(Lock)이나 성능 저하가 발생할 수 있습니다.
    성능: 13,000개 이상의 행을 처리할 때 시스템의 CPU, 메모리, I/O 자원을 많이 사용하게 됩니다. 임시 테이블을 활용한 일괄 처리는 성능 향상에 도움이 되지만, 동시에 여러 사용자가 업로드를 시도할 경우 부하가 발생할 수 있습니다.
    보안: 엑셀 파일 업로드 기능이므로, 악의적인 파일 업로드를 방지하기 위한 파일 유효성 검증 로직이 필요합니다. 기능에 대한 접근 권한 설정도 필수적입니다.

## 3. 설계
    * 아키텍처:
        * 사용자 요청을 받는 웹 계층(Web Layer)과 비즈니스 로직을 처리하는 서비스 계층(Service Layer), 데이터베이스와 소통하는 데이터 접근 계층(Data Access Layer)을 분리하여 설계합니다.
        * 엑셀 업로드 작업이 시간이 오래 걸리는 점을 고려하여 비동기 처리 구조를 도입합니다.
        * 엑셀 파일의 가변적인 컬럼 구조를 처리하기 위한 동적 파싱 로직을 구현합니다.
        * DB 업데이트 중 발생하는 에러를 별도의 테이블에 기록하여 최종 보고서에 활용합니다.
    * 인터페이스:
        * 프론트엔드: 파일을 선택하고 업로드하는 버튼, 진행 상황을 시각적으로 보여주는 진행률 바, 그리고 작업이 완료된 후 성공/실패 여부를 표시하는 최종 보고서 영역을 구성합니다.
        * 백엔드: 파일 업로드를 처리하는 REST API 엔드포인트를 구현합니다. 진행률 업데이트를 위해 웹소켓이나 SSE(Server-Sent Events) 등의 기술을 활용합니다.

## 4. 작업 순서 (체크리스트)
```
    * 1단계: 환경 설정 및 백엔드 개발
        [ ] 신규 개발을 위한 Git 브랜치 생성
        [ ] 엑셀 파일 파싱 및 임시 테이블 삽입 로직 개발 (컬럼 동적 매핑 포함)
        [ ] 메인 비즈니스 로직(우선순위 로직) 구현
        [ ] 실패 데이터 로깅 로직 개발
        [ ] 진행률 업데이트를 위한 통신 로직(API, 웹소켓 등) 구현
        [ ] 트랜잭션 관리 로직 구현 (모든 업데이트가 성공하거나, 전체가 롤백되도록)
    * 2단계: 데이터베이스 작업
        [ ] 엑셀 데이터를 저장할 임시 테이블 스키마 설계 및 생성
        [ ] 실패 데이터를 기록할 리포트 테이블 스키마 설계 및 생성
    * 3단계: 프론트엔드 개발 및 통합
        [ ] 파일 업로드 UI 컴포넌트 개발
        [ ] 진행률 바 및 상태 메시지 표시 컴포넌트 개발
        [ ] 백엔드 API와의 연동 로직 구현
        [ ] 최종 보고서 UI 개발 (실패 건 목록 테이블)
    * 4단계: 테스트 및 배포 준비
        [ ] 단위 테스트 및 통합 테스트 수행
        [ ] 성능 테스트 시나리오 작성 및 실행
        [ ] 배포 절차 문서화 및 롤백 계획 점검
```

## 5. 테스트 계획
    * 단위 테스트:
        * 엑셀 파싱: 컬럼의 순서와 개수가 다른 여러 엑셀 파일로 테스트하여 데이터가 올바르게 매핑되는지 확인합니다.
        * 비즈니스 로직: 각 우선순위 조건(1, 2, 3)에 해당하는 샘플 데이터를 만들어 업데이트 결과가 올바른지 확인합니다. 여러 조건이 중복되는 경우 우선순위가 제대로 적용되는지 검증합니다.
    * 통합 테스트:
        * 전체 워크플로우: 프론트엔드 UI에서 엑셀 파일을 업로드한 후, 진행률이 정상적으로 표시되고 최종 보고서가 올바르게 나오는지 확인합니다.
        * 에러 처리: 잘못된 형식의 파일, 존재하지 않는 오더 번호 등 비정상적인 데이터로 테스트하여 에러가 올바르게 처리되고 리포트에 기록되는지 확인합니다.
    * 회귀 테스트:
        * 엑셀 업로드 기능 추가 후 기존의 다른 기능(예: 오더 조회, 수정 등)이 정상적으로 작동하는지 확인합니다.
    * 성능 테스트:
        * 13,000개 이상의 행을 가진 대용량 엑셀 파일을 업로드하여 처리 시간을 측정하고, 시스템 자원 사용량을 모니터링합니다.

## 6. 배포/롤백 절차 (무중단 고려)
    * 배포:
        1. DB 스키마 변경: 신규 임시 테이블 스키마와 리포트 테이블 스키마를 운영 DB에 선반영합니다.
        2. 소스 빌드: 새로운 코드를 빌드하여 배포용 War 파일을 생성합니다.
        3. 무중단 배포: 기존 서비스가 중단되지 않도록 무중단 배포 방식(예: 블루-그린 또는 롤링 업데이트)을 이용해 신규 War 파일을 배포합니다.
        4. 트래픽 전환: 신규 버전의 서비스가 정상적으로 동작하는 것을 확인한 후, 모든 사용자 트래픽을 신규 버전으로 전환합니다.
        5. 구 버전 중지: 구 버전 인스턴스를 서서히 중지합니다.
    * 롤백:
        1. 문제 감지: 신규 배포 후 치명적인 문제가 발견되면 즉시 롤백을 결정합니다.
        2. 트래픽 전환: 모든 사용자 트래픽을 즉시 구 버전 서비스 인스턴스로 전환합니다.
        3. 신규 버전 중지: 문제가 발생한 신규 버전 서비스 인스턴스를 중지하고, 필요시 배포 파일을 삭제합니다.
        4. 데이터 롤백: 업데이트된 데이터가 손상되었을 경우, 미리 백업해둔 DB 데이터를 이용해 복구합니다. (이 과정은 매우 중요하므로 배포 전 백업 필수)

## 7. 모니터링 및 운영 포인트
    * 로그 모니터링:
        * 엑셀 업로드 작업의 시작, 진행, 완료, 실패에 대한 로그를 남겨 작업 흐름을 추적할 수 있도록 합니다.
        * DB 업데이트 시 발생하는 에러 로그를 상세하게 기록하여 문제 원인을 빠르게 파악합니다.
    * 성능 모니터링:
        * 업로드 작업 중 서버의 CPU, 메모리 사용량 및 DB의 부하 상태를 지속적으로 모니터링합니다.
        * DB 쿼리 실행 계획 및 락(Lock) 발생 여부를 주기적으로 확인합니다.
    * 운영 관리:
        * 엑셀 작업 완료 후 생성된 임시 테이블 데이터를 정기적으로 정리합니다.
        * 실패 보고서의 내용을 담당자에게 자동으로 통보하는 알림 시스템을 구축하는 것을 고려합니다.
        * 사용자가 대량의 파일을 동시에 업로드하지 않도록 안내하는 정책을 수립합니다.

## 8. 리스크 및 완료 기준
    *주요 리스크:
        *데이터 정합성: 대량 업데이트 중 서버 장애나 네트워크 문제 발생 시 데이터가 일부만 반영되어 정합성이 깨질 수 있습니다.
        *성능 저하: 임시 테이블을 사용하더라도 대규모 DB 업데이트 작업 중 기존 서비스의 성능에 영향을 줄 수 있습니다.
        *파일 형식: 엑셀 파일의 컬럼 구성이 예측 범위를 벗어나거나, 데이터 형식이 잘못될 경우 파싱 에러로 인해 작업이 중단될 수 있습니다.
        *진행률 표시 오버헤드: 실시간으로 진행률을 자주 업데이트하면 통신 오버헤드가 발생해 오히려 전체 성능이 저하될 수 있습니다.
    *완료 기준:
        *기능 완성: 모든 요구사항(엑셀 업로드, DB 업데이트, 진행률 표시, 보고서 생성)이 정상적으로 동작함을 확인합니다.
        *테스트 통과: 모든 테스트 시나리오(단위, 통합, 회귀, 성능)를 성공적으로 통과합니다.
        *성능 만족: 대용량 파일 업로드 시 설정한 성능 지표(처리 시간, 자원 사용량 등)를 만족합니다.
        *문서화: 작업 흐름 문서, 배포/롤백 절차, 운영 매뉴얼 등 관련 문서가 모두 완성되고 검증되었습니다.

Canvas 사용하지 않고 다시 시도하기
이 문서는 작업 전반에 걸쳐 팀원들이 같은 방향을 보고 소통하는 데 도움이 될 거예요. 문서 내용이 좀 더 구체적으로 필요하거나 특정 부분을 수정하고 싶다면 언제든지 말해주세요. 성공적인 작업이 되기를 바랍니다!