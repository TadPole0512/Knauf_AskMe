아래는 엑셀 업로드 기반 DB 업데이트 기능 추가를 위한 **운영 작업 흐름 문서**야. 요구사항에서부터 영향도 분석, 설계, 작업 단계, 테스트, 배포, 모니터링 포인트, 리스크 및 완료 기준을 쉽게 정리했으니 개발/QA/운영 모두 참고하기 좋아.

***

# 1. 요구사항 명세

- **웹에서 엑셀 파일을 업로드하면 해당 파일의 특정 컬럼을 바탕으로 DB 2개 테이블(O_SALESORDER, QMS_SALESORDER) 동시 업데이트** 
- 엑셀 파일 구조:
  - 반드시 SalesDocument, Sales Document Item, Reason for rejection, DS, OS 컬럼 포함
  - 컬럼 순서/수는 파일마다 상이
  - 최대 13000+ 행 가능
- 업무 로직 조건:
  - Reason for rejection 값이 Null이 아니면 주문 "취소" 처리(최우선)
  - DS=‘C’면 "배송완료" 처리(2순위)
  - DS가 Null이고 OS=‘C’면 "배송완료" 처리(3순위)
  - SALES DOCUMENT ITEM값에 100을 곱해 DB의 LINE_NO와 매칭
- UI에서 업로드 후 진행률 표시, 실패 건수/정보(리포트) 출력
- 임시 테이블 활용, DB 전체 갱신 작업 임시 테이블 기반 진행
- 작업 속도/구조 유동성, 리포트 기록 필요 

***

# 2. 영향도 분석

- **모듈 영향**
  - 파일 업로드, 데이터 파싱, 진행률 표시, 백엔드 업데이트 로직 등 신규/수정 API 필요
  - 실패 리포트 관리 로직 추가
- **DB 영향**
  - 임시 테이블 신규 생성(매 파일 구조에 맞춰 동적 생성 필요)
  - 실패 리포트 테이블 신설 가능성
  - O_SALESORDER, QMS_SALESORDER 동시 업데이트
- **성능 영향**
  - 대용량 파일(multi-row) 일괄 처리 → 트랜잭션/배치 처리 집중, 인덱스 활용/DB 락 주의
  - 진행률 표시 처리시 병렬/비동기 처리 고려
- **보안 영향**
  - 업로드 파일 확장자·내용검증, SQL Injection 방지
  - 데이터 접근·권한 통제 필요
  - 실패 정보 노출 제한(민감정보 주의) 

***

# 3. 설계(아키텍처 및 인터페이스)

- **아키텍처**
  - Presentation: Spring Web(front + REST API)
  - Service: 파일 수신 → 임시테이블 생성/적재 → DB 업데이트 → 실패 정보 기록
  - Batch/비동기: 진행률 표시용 이벤트 or polling 처리
- **인터페이스**
  - 웹 화면: 파일 업로드, 진행률 bar, 실패 건수/사유 리포트 제공
  - API: 엑셀 데이터 추출→임시테이블 생성/적재→DB업데이트→리포트 조회·다운로드
  - DB: 임시테이블 동적 생성(DDL), 실패 리포트 테이블(Read/Write)
- **확장 포인트**
  - 컬럼 자동 매칭, 임시테이블 타입 유동설정
  - 오류 리포트 테이블 구조 유연성(확장 가능) 

***

# 4. 작업 순서(Checklist)

- [ ] 요구사항 및 테이블 구조 확정, 컬럼 사전 정의
- [ ] 웹 업로드 화면/진행률 표시 UI 설계·구현
- [ ] 업로드 이벤트 처리(파일유효성·사이즈·컬럼체크 등)
- [ ] 임시테이블 동적생성 및 전체 데이터 bulk 적재
- [ ] SALES DOCUMENT ITEM·ORDERNO 등 키값 매칭 로직 구현(100곱셈·AND조건)
- [ ] 상태값 판정 로직(1,2,3번 우선순위 적용) 및 DB동시 업데이트 구현
- [ ] 실패 건 리포트 DB에 저장, UI 통한 결과 표시 모듈 구축
- [ ] 예외처리·DB트랜잭션·롤백 처리 추가
- [ ] 보안 검토 및 부수적 영향 평가
- [ ] 전체 기능 QA·테스트 계획 수립 

***

# 5. 테스트 계획

- **단위 테스트**
  - 파일 파싱, 컬럼 매칭, 임시테이블 동적생성, 판정·업데이트 로직 각각 검증
- **통합 테스트**
  - 전체 업로드 > 임시테이블 > DB동기화 > 실패 리포트 > UI 표시까지 end-to-end 검증
- **회귀 테스트**
  - 기존 오더 데이터 처리 로직 영향, 대용량(최대 건수) 스트레스, 동시성, 성능 반복 점검
- **예외처리 테스트**
  - 파일 손상/컬럼없음/키값미존재 등 다양한 실패 case 시나리오, 리포트 정확성
- **보안 테스팅**
  - 업로드 파일 악성코드/권한 체크, SQL Injection 등 위험 테스트 

***

# 6. 배포/롤백 절차(무중단 고려)

- **배포 사전**
  - 릴리즈/백업/DB 임시테이블・리포트테이블 사전 생성
  - 시스템 영향 범위 샘플 점검(스테이징)
- **배포**
  - 신규 배치/서비스 모듈 롤아웃, 무중단 자동 스위치 방식 적용
  - DB & WAS 배포 순서 동기화, 서비스 진행 도중 사용자 작업 영향 최소화
- **롤백**
  - 오류 발생 시 기존 프로시저/데이터 롤백 방안
  - 임시테이블·리포트테이블 제거 or 이전 상태 복구
  - 장애 복구시 백업본 restore 또는 히스토리 활용 

***

# 7. 모니터링/운영 포인트

- **진행률 View 연동 정상 확인**
- **성공/실패 리포트 실시간 모니터링**
- **배치·Bulk 트랜잭션 완료율, 오류율, 레코드수 등 점검**
- **임시테이블/리포트테이블 non-growth(잔존/삭제) 관리**
- **DB CPU/메모리/IO 등 성능 모니터링**
- **보안 로그 및 업로드 내역 감시**
- **운영팀 대응 프로세스 마련, 장애 발생시 알림 연계** 

***

# 8. 리스크/완료 기준

- **리스크**
  - 대용량 데이터 처리로 인한 서버/DB 부하
  - 불완전 파일 구조(컬럼 누락, 값 오류)로 오류 대량 발생
  - 트랜잭션 실패 시 데이터 inconsistent 상황
  - 직관적 UI/진행률 표시 미흡 시 사용자 혼란
  - 확장성 부족(임시테이블 관리, 리포트 테이블 용량 등)
  - 보안 취약점(업로드 무작위 파일, URL 노출 등) 
- **완료 기준**
  - 엑셀 업로드건에 대해 성공/실패 리포트 완벽 수집 및 UI에 제공
  - 임시테이블/리포트테이블 자동 관리
  - O_SALESORDER/QMS_SALESORDER 업데이트 정상 실행(조건/우선순위 준수)
  - 주요 케이스 별 테스트/회귀 점검 전부 통과
  - 성능/보안/운영 항목 정상 모니터링
  - 무중단 배포 후 장애 무발생 

---