## 사용된 분석 공식 및 접근법

**적용 공식**: 문제 재정의 알고리즘(PR), 복잡성 해결 매트릭스(CS), 다차원 분석 프레임워크(MDA)
- **PR**: 단순 엑셀 업로드 → 대용량 데이터 실시간 처리 시스템으로 재정의
- **CS**: 업로드-파싱-임시테이블-업데이트-리포트 단계별 복잡성 분해
- **MDA**: 성능(시간), 안정성(트랜잭션), 사용성(진행률) 차원 분석

---

# 엑셀 업로드 기반 주문 상태 업데이트 시스템 구현

## 1. 요구사항 명세

### 1.1 기능 요구사항
- 웹 페이지에서 엑셀 파일 업로드 기능 제공
- 동적 컬럼 구조 엑셀 파일 처리 (컬럼 순서/개수 가변)
- 대용량 데이터 처리 (13,000건 이상)
- 실시간 진행률 표시 기능
- 처리 실패 건에 대한 상세 리포트 제공
- O_SALESORDER, QMS_SALESORDER 테이블 동시 업데이트

### 1.2 비기능 요구사항
- 13,000건 처리 시간 30분 이내 완료
- 메모리 사용량 1GB 이하 유지
- 동시 업로드 사용자 최대 3명 지원
- 트랜잭션 단위별 롤백 지원
- 진행률 업데이트 간격 1초 이내

### 1.3 비즈니스 규칙
- Reason for rejection 우선순위 최상위 (STATUS1=980, STATUS=999)
- DS=C 두 번째 우선순위 (STATUS1=580, STATUS=620)
- DS=null이고 OS=C 세 번째 우선순위 (STATUS1=580, STATUS=620)

## 2. 영향도 분석

### 2.1 모듈 영향도
- **신규 모듈**: ExcelUploadController, ExcelProcessService, ProgressService
- **기존 모듈**: 공통 파일 업로드 유틸리티 확장 필요
- **의존성**: Apache POI, 스케줄러 라이브러리 추가
- **설정 파일**: application.properties에 임시테이블 설정 추가
- **JSP/JS**: 파일 업로드 화면, 진행률 표시 화면 신규 개발

### 2.2 데이터베이스 영향도
- **신규 테이블**: EXCEL_TEMP (동적 생성), UPLOAD_PROGRESS, ERROR_LOG
- **기존 테이블**: O_SALESORDER, QMS_SALESORDER (업데이트만)
- **인덱스**: ORDERNO, LINE_NO 복합 인덱스 성능 확인 필요
- **저장공간**: 임시테이블로 인한 일시적 용량 증가 (최대 500MB)

### 2.3 성능 영향도
- **메모리**: 대용량 엑셀 처리로 힙 메모리 사용량 증가
- **CPU**: 배치 처리 중 CPU 사용률 상승 예상
- **네트워크**: 진행률 폴링으로 트래픽 소폭 증가
- **디스크 I/O**: 임시테이블 생성/삭제로 I/O 부하 증가

### 2.4 보안 영향도
- **파일 업로드**: 확장자, 크기 제한 정책 적용
- **권한 관리**: 업로드 기능 접근 권한 통제
- **데이터 보호**: 임시테이블 자동 삭제 로직 필수
- **로그 관리**: 민감 데이터 로그 출력 방지

## 3. 설계

### 3.1 아키텍처 설계
- **프레젠테이션 계층**: JSP + AJAX 기반 비동기 처리
- **비즈니스 계층**: Service 계층에서 배치 처리 로직 구현
- **데이터 접근 계층**: MyBatis 매퍼를 통한 대용량 데이터 처리
- **배치 처리**: 별도 스레드에서 백그라운드 실행
- **상태 관리**: 인메모리 캐시를 통한 진행률 관리

### 3.2 인터페이스 설계
- **업로드 API**: POST /api/excel/upload (multipart/form-data)
- **진행률 API**: GET /api/excel/progress/{sessionId}
- **결과 조회 API**: GET /api/excel/result/{sessionId}
- **에러 로그 API**: GET /api/excel/errors/{sessionId}
- **세션 관리**: UUID 기반 세션 식별자 사용

### 3.3 데이터 모델 설계
- **EXCEL_TEMP**: 동적 컬럼 생성 (VARCHAR(MAX) 활용)
- **UPLOAD_PROGRESS**: 세션ID, 진행률, 상태, 시작/종료시간
- **ERROR_LOG**: 세션ID, 행번호, 에러코드, 에러메시지
- **임시테이블 명명**: TEMP_EXCEL_{SESSION_ID}_{TIMESTAMP}

## 4. 작업 순서

### 4.1 사전 준비 작업
- [ ] 개발 환경에 Apache POI 라이브러리 추가
- [ ] 데이터베이스 권한 확인 (임시테이블 생성/삭제)
- [ ] 파일 업로드 디렉토리 생성 및 권한 설정
- [ ] 메모리 설정 조정 (힙 크기 증가)
- [ ] 테스트용 샘플 엑셀 파일 준비

### 4.2 데이터베이스 작업
- [ ] UPLOAD_PROGRESS 테이블 생성
- [ ] ERROR_LOG 테이블 생성
- [ ] 기존 테이블 인덱스 성능 분석
- [ ] 임시테이블 생성/삭제 저장프로시저 작성
- [ ] 배치 업데이트용 저장프로시저 작성

### 4.3 백엔드 개발
- [ ] 엑셀 파일 파싱 유틸리티 클래스 개발
- [ ] 동적 임시테이블 생성 서비스 개발
- [ ] 진행률 관리 서비스 개발
- [ ] 배치 처리 서비스 개발
- [ ] 에러 처리 및 로깅 서비스 개발

### 4.4 프론트엔드 개발
- [ ] 파일 업로드 화면 개발
- [ ] 진행률 표시 컴포넌트 개발
- [ ] 결과 리포트 화면 개발
- [ ] 에러 상세 조회 화면 개발
- [ ] AJAX 통신 및 폴링 로직 구현

### 4.5 통합 및 최적화
- [ ] 각 모듈 간 연동 테스트
- [ ] 성능 테스트 및 최적화
- [ ] 메모리 누수 점검
- [ ] 예외 상황 처리 검증
- [ ] 로그 레벨 및 출력 내용 조정

## 5. 테스트 계획

### 5.1 단위 테스트
- [ ] 엑셀 파일 파싱 로직 검증
- [ ] 동적 테이블 생성 기능 검증
- [ ] 진행률 계산 로직 검증
- [ ] 우선순위 비즈니스 룰 검증
- [ ] 에러 처리 로직 검증

### 5.2 통합 테스트
- [ ] 전체 업로드 프로세스 end-to-end 테스트
- [ ] 대용량 파일 처리 성능 테스트
- [ ] 동시 업로드 시나리오 테스트
- [ ] 네트워크 오류 상황 테스트
- [ ] 데이터베이스 연결 오류 테스트

### 5.3 회귀 테스트
- [ ] 기존 주문 관리 기능 영향도 확인
- [ ] 기존 파일 업로드 기능 정상 동작 확인
- [ ] 전체 시스템 성능 영향도 측정
- [ ] 메모리 사용량 변화 모니터링
- [ ] 로그 파일 크기 및 로테이션 확인

### 5.4 사용자 수락 테스트
- [ ] 실제 업무 시나리오 기반 테스트
- [ ] 다양한 엑셀 파일 형식 검증
- [ ] 사용자 인터페이스 사용성 평가
- [ ] 에러 메시지 명확성 확인
- [ ] 처리 결과 정확성 검증

## 6. 배포/롤백 절차

### 6.1 배포 절차
- [ ] 운영 환경 데이터베이스 스키마 업데이트
- [ ] 애플리케이션 소스 백업 및 배포
- [ ] 설정 파일 업데이트 (메모리, 파일 경로)
- [ ] 서비스 재시작 (무중단 배포 권장)
- [ ] 배포 후 기본 기능 동작 확인

### 6.2 무중단 배포 고려사항
- [ ] 로드밸런서를 통한 순차 배포
- [ ] 데이터베이스 스키마 호환성 확인
- [ ] 기존 세션 유지 방안 검토
- [ ] 배포 중 신규 업로드 차단 메시지 표시
- [ ] 헬스체크 엔드포인트 구현

### 6.3 롤백 절차
- [ ] 이전 버전 소스 복원
- [ ] 신규 추가된 테이블 드롭
- [ ] 설정 파일 원복
- [ ] 서비스 재시작 및 기능 확인
- [ ] 사용자 공지사항 업데이트

## 7. 모니터링/운영 포인트

### 7.1 시스템 모니터링
- [ ] CPU 사용률 임계치 설정 (80% 초과 시 알림)
- [ ] 메모리 사용량 모니터링 (힙 메모리 90% 초과 시 알림)
- [ ] 디스크 사용량 추적 (임시테이블로 인한 증가)
- [ ] 네트워크 트래픽 모니터링
- [ ] 데이터베이스 커넥션 풀 상태 확인

### 7.2 애플리케이션 모니터링
- [ ] 업로드 처리 시간 추적
- [ ] 실패율 모니터링 (10% 초과 시 점검)
- [ ] 동시 사용자 수 모니터링
- [ ] 임시테이블 생성/삭제 현황 추적
- [ ] 에러 로그 패턴 분석

### 7.3 비즈니스 모니터링
- [ ] 일일 업로드 건수 집계
- [ ] 처리 성공률 리포트
- [ ] 평균 처리 시간 트렌드 분석
- [ ] 사용자별 이용 패턴 분석
- [ ] 업무 시간대별 부하 분석

### 7.4 운영 자동화
- [ ] 임시테이블 자동 정리 스케줄러 (매일 새벽 2시)
- [ ] 에러 로그 자동 아카이빙 (30일 보관)
- [ ] 시스템 자원 사용량 일일 리포트
- [ ] 장애 발생 시 자동 알림 설정
- [ ] 정기 백업 스케줄 확인

## 8. 리스크 및 완료 기준

### 8.1 주요 리스크
- [ ] **성능 리스크**: 대용량 처리 시 시스템 부하 급증
- [ ] **메모리 리스크**: OutOfMemory 에러 발생 가능성
- [ ] **데이터 리스크**: 임시테이블 미삭제로 인한 용량 부족
- [ ] **동시성 리스크**: 다중 사용자 업로드 시 리소스 경합
- [ ] **보안 리스크**: 악성 파일 업로드 또는 대용량 파일 공격

### 8.2 리스크 대응 방안
- [ ] 처리 시간 제한 설정 (최대 1시간)
- [ ] 파일 크기 제한 (최대 50MB)
- [ ] 동시 업로드 사용자 제한 (최대 3명)
- [ ] 임시테이블 자동 삭제 로직 강화
- [ ] 시스템 리소스 모니터링 강화

### 8.3 완료 기준
- [ ] **기능 완료**: 모든 요구사항 구현 및 테스트 통과
- [ ] **성능 완료**: 13,000건 30분 이내 처리 달성
- [ ] **안정성 완료**: 7일간 무장애 운영 확인
- [ ] **문서 완료**: 운영 매뉴얼 및 장애 대응 가이드 작성
- [ ] **교육 완료**: 운영진 대상 시스템 사용법 교육 실시

### 8.4 품질 기준
- [ ] 코드 커버리지 80% 이상 달성
- [ ] 성능 테스트 통과 (목표 시간 내 처리)
- [ ] 보안 취약점 점검 완료
- [ ] 사용자 만족도 조사 실시
- [ ] 장애 복구 테스트 완료