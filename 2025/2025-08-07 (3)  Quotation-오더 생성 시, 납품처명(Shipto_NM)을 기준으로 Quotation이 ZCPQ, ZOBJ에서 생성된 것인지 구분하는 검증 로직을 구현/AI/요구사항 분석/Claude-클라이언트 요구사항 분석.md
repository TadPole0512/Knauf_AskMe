# 아래 내용의 비지니스 로직을 정리해서 알려줘.

**개발 목적**
오더 생성 시, 납품처명(Shipto_NM)을 기준으로 Quotation이 ZCPQ(OneCRM)에서 생성된 것인지, ZOBJ(기존 시스템)에서 생성된 것인지 구분하여 검증 로직을 구현합니다.
1. **ZOBJ**: 기존 시스템에서 생성된 Quotation.
2. **ZCPQ**: 최근 도입된 OneCRM 시스템에서 생성된 Quotation.
 
 
**요구 사항**
**1. Quotation 검증 로직**
오더 생성 시, 납품처명(Shipto_NM)을 기준으로 Quotation의 출처를 구분하고, 이에 따라 검증 단계를 진행합니다.
* **조건 1: 납품처명에 'KR' 포함 여부 확인**
   * **Shipto_NM에 'KR'이 prefix로 포함된 경우:**
      * 해당 Quotation은 ZCPQ(OneCRM) 에서 생성된 것으로 간주합니다.
      * 품목 검증(2번) 을 진행합니다.
      * 참고: ZCPQ에서 생성된 모든 납품처명은 'KR'로 시작하며, 이는 필수값입니다.
      * **예시:**
         * Shipto_NM = **KR_수서지점 공사현장** → ZCPQ로 간주, 품목 검증 진행.
 
* **Shipto_NM에 'KR'이 포함되지 않은 경우:**
   * 해당 Quotation은 ZOBJ(기존 시스템)에서 생성된 것으로 간주합니다.
   * 품목 검증(2번) 없이 바로 주문 접수를 진행합니다.
   * **예시:**
      * Shipto_NM = **한국목재 인천지점** → ZOBJ로 간주, 품목 검증 생략.
 
 
***예외 처리***
특정 조건에 따라 Quotation 검증 로직에서 예외 처리를 적용합니다.
* **예외 1: ZOBJ Quotation인데 납품처명에 'KR'이 포함된 경우**
   * 예: Shipto_NM = **KR산업** (실제 업체명이 'KR'로 시작). -> *현재는 KR산업 1건만 해당*
   * 이 경우, 해당 Quotation은 **ZOBJ**로 간주하며, **품목 검증을 생략**합니다.
 
* **예외 2: 납품처명에 'KR'이 중복으로 포함된 경우**
   * 예: Shipto_NM = **KR_KR산업**.
   * 이 경우, 해당 Quotation은 **ZCPQ**로 간주하며, **품목 검증을 진행**합니다.
 
** **
~~**2. 품목 유무 검증**~~** **(해당 로직은 최근 개발 완료)
ZCPQ Quotation의 품목 유무를 확인하여 주문 접수 가능 여부를 결정합니다. **검증 방법:**
* **O_Quotation_Verification** 테이블을 사용하여 품목 검증을 진행합니다.
* **품목이 있는 경우:** 주문 접수를 진행합니다.
* **품목이 없는 경우:** 주문 접수가 불가합니다.

---------------------------------------------------------------------

## 📋 주문 검증 비즈니스 로직 정리

### 🎯 핵심 목적
주문 생성할 때 납품처명을 보고 어떤 시스템에서 만든 견적서인지 구분해서 맞는 검증 과정을 적용하는 거야.

---

## 🔍 시스템 구분 로직

### 1단계: 납품처명 분석
납품처명(Shipto_NM)에서 **'KR'** 문자가 앞에 붙어있는지 확인

### 2단계: 시스템 분류

| 조건 | 시스템 | 검증 진행 |
|------|--------|-----------|
| 납품처명이 'KR'로 시작 | ZCPQ (OneCRM) | 품목 검증 **진행** |
| 납품처명이 'KR'로 시작 안함 | ZOBJ (기존 시스템) | 품목 검증 **생략** |

---

## 📝 구체적인 처리 흐름

### ZCPQ 케이스 (KR로 시작)
```
납품처명: "KR_수서지점 공사현장"
↓
ZCPQ 시스템으로 판단
↓
O_Quotation_Verification 테이블로 품목 검증
↓
품목 있음 → 주문 접수 진행
품목 없음 → 주문 접수 불가
```

### ZOBJ 케이스 (KR로 시작 안함)
```
납품처명: "한국목재 인천지점"
↓
ZOBJ 시스템으로 판단
↓
품목 검증 생략하고 바로 주문 접수 진행
```

---

## ⚠️ 예외 처리 케이스

### 예외 1: 실제 업체명이 KR로 시작하는 경우
```
납품처명: "KR산업"
실제 상황: ZOBJ 시스템 견적서 + 업체명이 진짜 KR산업
처리 방법: ZOBJ로 간주 → 품목 검증 생략
```

### 예외 2: KR이 중복으로 들어간 경우
```
납품처명: "KR_KR산업"
실제 상황: ZCPQ 시스템에서 KR산업 업체 등록
처리 방법: ZCPQ로 간주 → 품목 검증 진행
```

---

## 🔧 구현시 고려사항

### 우선순위 체크리스트
1. **문자열 시작 확인**: `Shipto_NM.startsWith("KR")`
2. **예외 케이스 먼저 처리**: KR산업 같은 특수 케이스
3. **일반 로직 적용**: 나머지 케이스들
4. **검증 단계 진행**: ZCPQ면 품목 검증, ZOBJ면 바로 접수

### 추가 확인 필요한 부분
- KR산업 외에 다른 예외 업체가 더 있는지?
- 납품처명 데이터 정제 규칙이 있는지?
- 대소문자 구분 여부는?

이 로직으로 개발하면 시스템별로 적절한 검증 과정을 거쳐서 주문이 처리될 거야. 혹시 특정 부분에 대해 더 자세히 알고 싶은 게 있어?

---------------------------------------------------------------------

# 'KR_'로 시작하면 'ZCPQ'로 분류하고, 그외 'KR'로 시작하는 경우는 'ZOBJ'인가?

---------------------------------------------------------------------

아, 정확한 지적이야! 원문을 다시 보니 패턴이 명확하네.

## 🔍 정확한 분류 기준

### 실제 패턴 분석

| 패턴 | 예시 | 시스템 분류 | 이유 |
|------|------|-------------|------|
| **KR_**로 시작 | `KR_수서지점 공사현장`<br>`KR_KR산업` | **ZCPQ** | OneCRM에서 생성할 때 KR_ 접두사 사용 |
| **KR**로만 시작<br>(언더바 없음) | `KR산업` | **ZOBJ** | 실제 업체명이 KR로 시작하는 경우 |

---

## 🔧 수정된 로직

```javascript
function classifyQuotationSystem(shiptoNM) {
    if (shiptoNM.startsWith('KR_')) {
        return 'ZCPQ';  // 품목 검증 진행
    } else {
        return 'ZOBJ';  // 품목 검증 생략
    }
}
```

### 처리 흐름
```
"KR_수서지점 공사현장" → KR_로 시작 → ZCPQ → 품목 검증 O
"KR_KR산업"           → KR_로 시작 → ZCPQ → 품목 검증 O
"KR산업"              → KR로만 시작 → ZOBJ → 품목 검증 X
"한국목재 인천지점"    → KR 없음   → ZOBJ → 품목 검증 X
```

---

## 💡 핵심 포인트

**OneCRM(ZCPQ)**: 시스템에서 자동으로 `KR_` 접두사를 붙여서 생성
**기존시스템(ZOBJ)**: 실제 업체명 그대로 사용 (KR산업, 한국목재 등)

이렇게 이해하는 게 맞지? `KR_` 유무로 구분하는 게 훨씬 명확하고 예외 처리도 필요 없어 보여.
