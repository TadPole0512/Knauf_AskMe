# 아래 내용의 비지니스 로직을 정리해서 알려줘.

**개발 목적**
오더 생성 시, 납품처명(Shipto_NM)을 기준으로 Quotation이 ZCPQ(OneCRM)에서 생성된 것인지, ZOBJ(기존 시스템)에서 생성된 것인지 구분하여 검증 로직을 구현합니다.
1. **ZOBJ**: 기존 시스템에서 생성된 Quotation.
2. **ZCPQ**: 최근 도입된 OneCRM 시스템에서 생성된 Quotation.
 
 
**요구 사항**
**1. Quotation 검증 로직**
오더 생성 시, 납품처명(Shipto_NM)을 기준으로 Quotation의 출처를 구분하고, 이에 따라 검증 단계를 진행합니다.
* **조건 1: 납품처명에 'KR' 포함 여부 확인**
   * **Shipto_NM에 'KR'이 prefix로 포함된 경우:**
      * 해당 Quotation은 ZCPQ(OneCRM) 에서 생성된 것으로 간주합니다.
      * 품목 검증(2번) 을 진행합니다.
      * 참고: ZCPQ에서 생성된 모든 납품처명은 'KR'로 시작하며, 이는 필수값입니다.
      * **예시:**
         * Shipto_NM = **KR_수서지점 공사현장** → ZCPQ로 간주, 품목 검증 진행.
 
* **Shipto_NM에 'KR'이 포함되지 않은 경우:**
   * 해당 Quotation은 ZOBJ(기존 시스템)에서 생성된 것으로 간주합니다.
   * 품목 검증(2번) 없이 바로 주문 접수를 진행합니다.
   * **예시:**
      * Shipto_NM = **한국목재 인천지점** → ZOBJ로 간주, 품목 검증 생략.
 
 
***예외 처리***
특정 조건에 따라 Quotation 검증 로직에서 예외 처리를 적용합니다.
* **예외 1: ZOBJ Quotation인데 납품처명에 'KR'이 포함된 경우**
   * 예: Shipto_NM = **KR산업** (실제 업체명이 'KR'로 시작). -> *현재는 KR산업 1건만 해당*
   * 이 경우, 해당 Quotation은 **ZOBJ**로 간주하며, **품목 검증을 생략**합니다.
 
* **예외 2: 납품처명에 'KR'이 중복으로 포함된 경우**
   * 예: Shipto_NM = **KR_KR산업**.
   * 이 경우, 해당 Quotation은 **ZCPQ**로 간주하며, **품목 검증을 진행**합니다.
 
** **
~~**2. 품목 유무 검증**~~** **(해당 로직은 최근 개발 완료)
ZCPQ Quotation의 품목 유무를 확인하여 주문 접수 가능 여부를 결정합니다. **검증 방법:**
* **O_Quotation_Verification** 테이블을 사용하여 품목 검증을 진행합니다.
* **품목이 있는 경우:** 주문 접수를 진행합니다.
* **품목이 없는 경우:** 주문 접수가 불가합니다.

---------------------------------------------------------------------

아, 오더 생성할 때 견적서(Quotation) 출처를 확인하는 로직이군요. 납품처 이름을 기준으로 새로운 시스템(OneCRM) 건인지 기존 시스템 건인지 구분하는 거네요. 제가 한눈에 들어오게끔 깔끔하게 정리해 드릴게요.

-----

### **핵심 비즈니스 로직: 납품처명(Shipto\_NM) 기반 시스템 구분**

이 로직의 가장 큰 목적은 **오더를 생성**할 때, 해당 오더의 기반이 된 **견적서가 어디서 만들어졌는지 판별**하고, 그에 따라 **후속 조치(품목 검증)를 다르게** 가져가는 것입니다.

  * **ZCPQ (OneCRM):** 신규 시스템. 품목 검증이 **필수**입니다.
  * **ZOBJ (기존 시스템):** 기존 시스템. 품목 검증을 **생략**합니다.

판단 기준은 오직 **납품처명(`Shipto_NM`)** 입니다.

| 조건                               | 판단 시스템 | 후속 조치             |
| :--------------------------------- | :---------- | :-------------------- |
| 납품처명이 **'KR'** 로 시작하는 경우 | **ZCPQ** | **품목 검증 진행** |
| 납품처명이 **'KR'** 로 시작하지 않는 경우 | **ZOBJ** | **품목 검증 생략** (즉시 주문 접수) |

\<br\>

**예시를 보면 더 명확해져요.**

  * `Shipto_NM` = "**KR\_수서지점 공사현장**"

      * 'KR'로 시작하므로 **ZCPQ**로 판단.
      * 따라서, **품목 검증 단계**로 넘어갑니다.

  * `Shipto_NM` = "**한국목재 인천지점**"

      * 'KR'로 시작하지 않으므로 **ZOBJ**로 판단.
      * 따라서, **품목 검증을 건너뛰고** 바로 주문을 접수합니다.

-----

### **까다로운 예외 처리 🧐**

규칙만 있으면 간단하겠지만, 항상 예외가 있죠. 이 로직에는 두 가지 중요한 예외 케이스가 있습니다.

#### **예외 1: 실제 회사 이름이 'KR'로 시작하는 경우**

  * **상황:** `Shipto_NM` = "**KR산업**"
  * **설명:** 규칙대로라면 'KR'로 시작하니 ZCPQ로 봐야 하지만, 이 경우는 실제 업체명이 'KR산업'인 **기존 시스템(ZOBJ) 데이터**입니다.
  * **처리:**
      * 납품처명이 정확히 '**KR산업**' 이라면, 예외적으로 **ZOBJ**로 간주합니다.
      * 따라서, **품목 검증을 생략**합니다.
      * *(현재는 'KR산업' 한 건만 해당된다고 하니, 특정 이름만 예외 처리하면 되겠네요.)*

#### **예외 2: 'KR' 접두사와 'KR' 회사명이 합쳐진 경우**

  * **상황:** `Shipto_NM` = "**KR\_KR산업**"
  * **설명:** ZCPQ(OneCRM)에서 'KR산업'으로 납품처를 생성하면, 'KR\_' 접두사가 붙어 이런 형태가 될 수 있습니다.
  * **처리:**
      * 이 경우는 원래 규칙대로 '**KR**'로 시작하는 것으로 봅니다.
      * 따라서, **ZCPQ**로 간주하고 **품목 검증을 진행**합니다.

-----

### **개발자를 위한 의사코드 (Pseudo-code)**

이 로직을 코드로 구현한다면 아래와 같은 흐름이 될 거예요.

```python
FUNCTION check_quotation_type(shipto_name):
    # 1순위: 예외 케이스 먼저 확인
    # 납품처명이 정확히 'KR산업'이면 무조건 ZOBJ
    IF shipto_name == "KR산업":
        RETURN "ZOBJ"  # 품목 검증 생략

    # 2순위: 기본 규칙 적용
    # 'KR'로 시작하면 ZCPQ (e.g., 'KR_수서지점', 'KR_KR산업' 모두 해당)
    ELSE IF shipto_name.startswith("KR"):
        RETURN "ZCPQ"  # 품목 검증 진행

    # 3순위: 그 외 모든 경우
    # 'KR'로 시작하지 않으면 ZOBJ
    ELSE:
        RETURN "ZOBJ"  # 품목 검증 생략

```

-----

### **한눈에 보기: 로직 최종 요약**

| `Shipto_NM` 예시           | 판단 시스템 | 품목 검증 여부 | 근거                               |
| :------------------------- | :---------- | :------------- | :--------------------------------- |
| **KR***수서지점 공사현장   | **ZCPQ** | **O** (진행)     | 'KR' 접두사 규칙                     |
| 한국목재 인천지점            | **ZOBJ** | **X** (생략)     | 'KR' 접두사 없음                    |
| **KR산업** | **ZOBJ** | **X** (생략)     | **예외 처리 1:** 특정 업체명 예외    |
| **KR*****KR산업** | **ZCPQ** | **O** (진행)     | 'KR' 접두사 규칙 (예외 처리 2에 해당) |

---------------------------------------------------------------------

# 'KR_'로 시작하면 'ZCPQ'로 분류하고, 그외 'KR'로 시작하는 경우는 'ZOBJ'인가?

---------------------------------------------------------------------

아니요, 설명이 조금 헷갈리게 된 것 같아요. 제가 더 명확하게 다시 설명해 드릴게요.

**'KR'로 시작하면 일단 전부 'ZCPQ'** 라고 보는 게 기본 규칙입니다. `KR_` 처럼 언더스코어(_)가 있든 없든 상관없어요.

---

### **정확한 분류 기준**

아주 간단한 2단계 규칙이라고 생각하시면 편해요.

1.  **먼저, 납품처명이 정확히 'KR산업'인지 확인합니다.**
    * 만약 `Shipto_NM` == "**KR산업**" 이라면, **이것만 예외적으로 `ZOBJ`** 로 분류합니다. (품목 검증 생략)

2.  **'KR산업'이 아니라면, 이제 'KR'로 시작하는지 확인합니다.**
    * `Shipto_NM`이 "**KR**"로 시작하는 모든 경우 (예: `KR_수서`, `KR어쩌고`, `KR_KR산업` 등)는 **전부 `ZCPQ`** 로 분류합니다. (품목 검증 진행)

**결론적으로,**

* `'KR_`'로 시작하는 경우 → **ZCPQ** (규칙 2)
* `'KR'`로 시작하지만 `'KR_`'가 아닌 다른 경우 (예: `KR서울`) → **ZCPQ** (규칙 2)
* 오직 `'KR산업'` 이라는 글자 그 자체일 때만 → **ZOBJ** (규칙 1)
* `'KR'`로 시작하지 않는 모든 경우 (예: `한국목재`) → **ZOBJ**
