아래 내용을 좀 더 쉽게, 그리고 단계별로 풀어서 설명해볼게.

📱 현재 상황 요약
오더접수/보류오더에 대한 MMS(문자메시지) 전송을 “E-Order”라는 시스템의 데이터베이스(DB)에서 관리하고 있음.

SAP 시스템에서 오더가 들어오면, 이 정보가 MMS를 발송하는 DB로 전달됨.

그런데, SAP에서 알 수 없는 이유로 똑같은 문자 전송 데이터가 여러 번 생성되는 문제가 발생함.

그래서 SAP에 “왜 이런 일이 생기는지 원인 파악”과 “잘못된 데이터 수정”을 요청해둔 상태.

하지만, 근본적인 해결(원인 파악 및 수정)이 될 때까지 임시방편으로 “중복 전송 방지 기능”을 DB에서 넣으려는 것.

🔄 MMS 문자 전송 프로세스(테이블 구조 및 흐름)
SAP에서 오더 확정
→ SAP에서 주문(오더)이 확정되면,

MMS_MSG 테이블에 오더 및 정보 전송
→ 문자 발송 정보가 MMS_MSG라는 테이블에 들어옴.

문자 전송이 끝나면 STATUS 값을 3으로 변경, 이후 로그 테이블로 이동
→ 문자 발송이 정상적으로 끝나면,

해당 데이터의 STATUS를 3으로 바꿈

그리고 MMS_LOG_YYYYMM (YYYYMM = 연월) 테이블로 이력(로그)을 남김

🛑 문제의 원인 및 임시 해결 방향
문제:
같은 오더, 같은 번호, 같은 메시지의 데이터가 여러 번 들어오면서 “중복 발송”이 생김.

근본 원인:
SAP에서 여러 번 데이터를 넣는 것으로 보임 (원인은 SAP 쪽에서 확인 예정)

임시 대책:
DB 차원에서 “중복 검증 옵션”을 넣어 중복 데이터가 들어오면 자동으로 처리할 수 있도록 함

🛠️ 원하는 임시 처리 로직(트리거 추가 검토)
💡 요구하는 트리거 동작
언제:
MMS_MSG 테이블에 **새로운 데이터(문자 전송 정보)**가 들어올 때

무엇을:
MMS_LOG_YYYYMM 테이블에서 phone(휴대폰 번호), **msg(문자 내용)**이 똑같은 게 있는지 검사

어떻게:
만약 같은 게 있으면,
→ MMS_MSG에 들어온 데이터의 **STATUS를 3(전송 완료)**로 바로 바꾼다
→ 즉, 바로 전송 완료 처리해서 실제 중복 문자 발송이 되지 않게 함

추가 조건:
MMS_LOG_YYYYMM은 월별로 테이블이 따로 존재함
(예: MMS_LOG_202406, MMS_LOG_202407 등)
전월 테이블까지 확인해야 함
(예: 6월 30일 오더는 7월 1일에도 들어올 수 있으니 두 달 분 모두 체크)

✅ 정리하면
MMS_MSG 테이블에 데이터가 추가될 때

MMS_LOG_이번달 + 지난달 테이블에서

phone, msg가 같은 데이터가 있는지 확인

있다면 → MMS_MSG 데이터의 STATUS를 3(전송 완료)로 바로 변경

없으면 → 그대로 진행

🚦 추가 참고사항
이런 트리거를 DB에 구현할 수 있는지를 검토 중임

트리거에서 여러 테이블(MMS_LOG_YYYYMM) 동시 참조/조회를 하는 게 복잡할 수 있으니,
테이블 구조나 실제 운영환경에 따라 구현 가능 여부/성능 등을 신중히 검토해야 함

궁금한 점이나, 좀 더 세부적으로 보고 싶은 부분 있으면 편하게 말해줘!